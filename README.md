# SI-2.0 - Автоматическая синхронизация и отчетность по запчастям

## Описание
n8n workflow для автоматической синхронизации данных о запчастях из внешнего API в PostgreSQL базу данных и отправки отчетов в CSV формате.

Авторы: Мишина Мария и Кондренко Дарья

## Основные функции
1. **Планирование**: Запуск по расписанию (ежечасно)
2. **Получение данных**: Пагинированное получение запчастей из REST API
3. **Обработка**: Валидация и нормализация данных
4. **Хранение**: Upsert в таблицу `spare_parts` PostgreSQL
5. **Отчетность**: Генерация и отправка CSV с обновленными записями за последние 5 минут

## Узлы (Nodes)
1. **Schedule Trigger** - Триггер по расписанию
2. **Fetch With Pagination** - Получение данных с пагинацией
3. **Process & Validate Data** - Валидация и обработка
4. **Upsert to DB** - Сохранение в PostgreSQL
5. **Code Time** - Генерация временной метки
6. **Execute SQL** - Выборка обновленных записей
7. **Build CSV** - Формирование CSV
8. **Send CSV** - Отправка отчета

## Структура данных
Таблица `spare_parts` содержит:
- `spare_code` (уникальный идентификатор)
- `spare_name`, `spare_description`
- `spare_type`, `spare_status`
- `price`, `quantity`
- `updated_at`, `last_sync_at`, `created_at`

## Особенности
- Автоматическая обработка ошибок валидации
- Пагинация до 1000 страниц
- Upsert по `spare_code`
- Отчет только по данным, синхронизированным в последние 5 минут
- Кодировка CSV: UTF-8

## Частота выполнения
Запускается каждый час (настраивается в Schedule Trigger)
